<!doctype html>
<html lang="en">
<head>
	<meta charset="utf-8" />
	<meta name="viewport" content="width=device-width, initial-scale=1.0" />

	<title>Vanta Settings</title>
	<link rel="stylesheet" href="index.css" />
	<link rel="icon" href="/favicon.ico" />

	<script src="panic.js"></script>

	<script>
		const SETTINGS_KEY = "vanta_settings";
		let captureMode = false;

		const DEFAULT_SETTINGS = {
			panicKey: "",
			panicUrl: "https://classroom.google.com"
		};

		function loadSettings() {
			try {
				return { ...DEFAULT_SETTINGS, ...JSON.parse(localStorage.getItem(SETTINGS_KEY)) };
			} catch {
				return { ...DEFAULT_SETTINGS };
			}
		}

		function saveSettings(settings) {
			localStorage.setItem(SETTINGS_KEY, JSON.stringify(settings));
		}

		window.addEventListener("DOMContentLoaded", () => {
			const settings = loadSettings();

			const keyDisplay = document.getElementById("panicKeyDisplay");
			const urlInput = document.getElementById("panicUrl");
			const modal = document.getElementById("keyModal");
			const status = document.getElementById("status");

			keyDisplay.textContent = settings.panicKey || "Not set";
			urlInput.value = settings.panicUrl;

			document.getElementById("setKeyBtn").onclick = () => {
				captureMode = true;
				status.textContent = "Waiting for key pressâ€¦";
				modal.style.display = "flex";
			};

			document.getElementById("cancelKeyBtn").onclick = () => {
				captureMode = false;
				status.textContent = "";
				modal.style.display = "none";
			};

			document.addEventListener("keydown", e => {
				if (!captureMode) return;

				e.preventDefault();
				captureMode = false;

				settings.panicKey = e.key;
				keyDisplay.textContent = e.key;

				saveSettings(settings);

				status.textContent = `Panic key set to "${e.key}"`;
				modal.style.display = "none";
			});

			document.getElementById("settings-form").onsubmit = e => {
				e.preventDefault();

				settings.panicUrl = urlInput.value.trim() || DEFAULT_SETTINGS.panicUrl;
				saveSettings(settings);

				status.textContent = "Settings saved";
			};
		});
	</script>

	<style>
		/* ===== Loader ===== */
		#loader {
			position: fixed;
			inset: 0;
			display: flex;
			flex-direction: column;
			justify-content: center;
			align-items: center;
			background: linear-gradient(180deg, #000, #1e4fff);
			z-index: 9999;
			transition: opacity 0.6s ease;
		}

		.loader-box {
			display: flex;
			flex-direction: column;
			align-items: center;
			gap: 20px;
			text-align: center;
		}

		.loader-logo {
			height: 18vh;
			max-height: 100px;
			animation: pulse 1.5s infinite alternate;
		}

		@keyframes pulse {
			0% { transform: scale(1); opacity: 1; }
			100% { transform: scale(1.05); opacity: 0.85; }
		}

		.progress {
			width: 260px;
			max-width: 80vw;
			height: 6px;
			background: rgba(255,255,255,0.25);
			border-radius: 8px;
			overflow: hidden;
		}

		.progress-bar {
			height: 100%;
			width: 1%;
			background: white;
			transition: width 0.2s ease-out;
			border-radius: 8px;
		}

		.percent {
			font-size: 13px;
			opacity: 0.75;
			font-weight: 500;
		}

		/* Settings page */
		body {
			font-family: "Roboto", Arial, sans-serif;
			color: white;
			background: linear-gradient(135deg, #000, #0f1f7a, #2152fe);
			min-height: 100vh;
			display: flex;
			flex-direction: column;
			align-items: center;
			padding: 0 20px;
		}

		header {
			margin: 20px 0;
			text-align: center;
		}

		.main {
			flex: 1;
			display: flex;
			flex-direction: column;
			align-items: center;
			width: 100%;
			max-width: 480px;
		}

		.settings-card {
			display: flex;
			flex-direction: column;
			gap: 18px;
			background: rgba(255,255,255,0.05);
			padding: 25px;
			border-radius: 12px;
			width: 100%;
			box-shadow: 0 4px 12px rgba(0,0,0,0.4);
			border: 1px solid rgba(255,255,255,0.2);
		}

		.row {
			display: flex;
			justify-content: space-between;
			align-items: center;
		}

		.settings-card input {
			height: 42px;
			padding: 0 14px;
			border-radius: 10px;
			border: 1px solid rgba(255,255,255,0.3);
			background: transparent;
			color: white;
			width: 100%;
		}

		.muted {
			font-size: 13px;
			opacity: 0.6;
		}

		.status {
			font-size: 13px;
			opacity: 0.8;
		}

		.icon-btn {
			background: none;
			border: none;
			color: white;
			cursor: pointer;
			font-size: 15px;
			padding: 8px 12px;
			border-radius: 6px;
			transition: background 0.2s ease;
		}

		.icon-btn:hover {
			background: rgba(255,255,255,0.1);
		}

		.modal {
			position: fixed;
			inset: 0;
			display: none;
			background: rgba(0,0,0,0.7);
			align-items: center;
			justify-content: center;
			z-index: 999;
		}

		.modal-box {
			background: #111;
			padding: 30px;
			border-radius: 12px;
			text-align: center;
			border: 1px solid rgba(255,255,255,0.2);
		}

		.secondary {
			opacity: 0.7;
		}

		.footer {
			margin: 20px 0;
			text-align: center;
		}

		.footer a {
			color: white;
			text-decoration: none;
			opacity: 0.8;
		}

		.footer a:hover {
			opacity: 1;
			text-decoration: underline;
		}
	</style>
</head>

<body>

	<!-- Loader -->
	<div id="loader">
		<div class="loader-box">
			<img src="sj.png" alt="Vanta Logo" class="loader-logo" />
			<div class="progress">
				<div class="progress-bar" id="progress-bar"></div>
			</div>
			<div class="percent" id="percent">0%</div>
		</div>
	</div>

	<header class="header">
		<h1>Settings</h1>
	</header>

	<main class="main">
		<form id="settings-form" class="settings-card">
			<h2>Panic System</h2>

			<div class="row">
				<span>Panic key</span>
				<strong id="panicKeyDisplay">Not set</strong>
			</div>

			<button type="button" id="setKeyBtn" class="icon-btn">
				Set Panic Key
			</button>

			<label>
				Redirect URL
				<input
					type="text"
					id="panicUrl"
					placeholder="https://classroom.google.com"
				/>
			</label>

			<p class="muted">
				Pressing the panic key will instantly redirect on any Vanta page.
			</p>

			<button type="submit" class="icon-btn">Save</button>

			<p id="status" class="status"></p>
		</form>
	</main>

	<footer class="footer">
		<a href="index.html">Back</a>
	</footer>

	<!-- Key Capture Modal -->
	<div id="keyModal" class="modal">
		<div class="modal-box">
			<h2>Press a key</h2>
			<p>That key will become your panic key.</p>
			<button type="button" id="cancelKeyBtn" class="icon-btn secondary">
				Cancel
			</button>
		</div>
	</div>

	<script>
		/* ===== Loader with smooth easing ===== */
		let progress = 0;
		const bar = document.getElementById("progress-bar");
		const percent = document.getElementById("percent");
		const loader = document.getElementById("loader");
		const app = document.body; // whole page

		function ease(current, target, speed = 0.05) {
			return current + (target - current) * speed;
		}

		let targetProgress = 0;

		const tick = setInterval(() => {
			if (targetProgress < 100) targetProgress += Math.random() * 2;

			progress = ease(progress, targetProgress);
			if (progress > 100) progress = 100;

			bar.style.width = progress + "%";
			percent.textContent = Math.floor(progress) + "%";

			if (progress >= 99.9) {
				clearInterval(tick);
				setTimeout(() => {
					loader.style.opacity = "0";
					setTimeout(() => loader.remove(), 600);
				}, 250);
			}
		}, 20);
	</script>

</body>
</html>
